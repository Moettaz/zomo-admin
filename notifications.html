<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - Zomo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #f4f6f8;
            display: grid;
            grid-template-columns: 200px 1fr;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            background-color: #2c2c2c;
            color: white;
            grid-row: 1 / 3;
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
        }

        .sidebar .logo-container {
            margin-bottom: 50px;
            text-align: center;
        }

        .sidebar .logo {
            width: 120px;
            height: auto;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li {
            margin-bottom: 5px;
        }

        .sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px 15px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .sidebar a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar .active {
            background-color: #FDBA1B;
            color: #2c3e50;
            font-weight: 500;
        }

        .sidebar .logout {
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 15px;
        }

        .sidebar .logout a {
            background-color: #e74c3c;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .sidebar .logout a:hover {
            background-color: #c0392b;
        }

        /* Header */
        .header {
            background-color: white;
            padding: 0 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .header h1 {
            margin: 0;
            font-size: 1.2rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .header .admin-connection {
            color: #7f8c8d;
            font-size: 0.85rem;
        }

        .header .admin-connection strong {
            color: #2c3e50;
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            overflow-y: auto;
        }

        .card {
            background-color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            padding-bottom: 10px;
            border-bottom: 1px solid #ecf0f1;
        }

        .accent-color {
            color: #FDBA1B;
        }

        /* Notification Table Styles */
        .notification-table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .notification-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            table-layout: fixed;
        }

        .notification-table th, .notification-table td {
            border: 1px solid #ecf0f1;
            padding: 8px 10px;
            text-align: left;
            vertical-align: top;
            word-wrap: break-word;
        }

        .notification-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        .notification-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .notification-table tr:hover {
            background-color: #f1f7fe;
        }

        /* Column Widths for Notification Table */
        .notification-table th:nth-child(1), .notification-table td:nth-child(1) { width: 5%; }
        .notification-table th:nth-child(2), .notification-table td:nth-child(2) { width: 10%; }
        .notification-table th:nth-child(3), .notification-table td:nth-child(3) { width: 10%; }
        .notification-table th:nth-child(4), .notification-table td:nth-child(4) { width: 10%; }
        .notification-table th:nth-child(5), .notification-table td:nth-child(5) { width: 15%; }
        .notification-table th:nth-child(6), .notification-table td:nth-child(6) { width: 20%; }
        .notification-table th:nth-child(7), .notification-table td:nth-child(7) { width: 10%; }
        .notification-table th:nth-child(8), .notification-table td:nth-child(8) { width: 10%; }

        /* Responsive Adjustments */
        @media screen and (max-width: 992px) {
            body {
                grid-template-columns: 70px 1fr;
            }

            .sidebar {
                padding: 15px 5px;
            }

            .sidebar a span {
                display: none;
            }

            .sidebar .logo {
                width: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
    <div class="logo-container">
                <img src="assets/zomo.png" alt="Zomo Logo" class="logo">
    </div>
    <ul>
        <li><a href="dashboard.html"><span>Dashboard</span></a></li>
        <li><a href="clients.html"><span>Clients</span></a></li>
        <li><a href="evaluation.html"><span>Evaluations</span></a></li>
        <li><a href="notifications.html" class="active"><span>Notifications</span></a></li>
        <li><a href="paiement.html"><span>Paiements</span></a></li>
    </ul>
    <div class="logout">
        <a href="connexion.html" onclick="return confirm('Êtes-vous sûr de vouloir vous déconnecter ?')">
            <span>Déconnecter</span>
        </a>
    </div>
</div>
    </div>

    <div class="header">
        <h1>Système de Notifications</h1>
        <div class="admin-connection">Connecté en tant que: <strong>Admin</strong></div>
    </div>

    <div class="main-content">
        <div class="card">
            <h3 class="card-title accent-color">Système de Notifications</h3>
            <p>Cette section vous permet de visualiser et de gérer les différentes notifications envoyées au sein de la plateforme Zomo, qu'il s'agisse d'alertes de service, de confirmations de paiement ou d'autres informations importantes.</p>
        </div>

        <div class="card" id="notifications-section">
            <h3 class="card-title">Liste des Notifications</h3>
            <div class="notification-table-container">
                <table class="notification-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>ID de l'expéditeur</th>
                            <th>ID du destinataire</th>
                            <th>ID du service</th>
                            <th>Type</th>
                            <th>Message</th>
                            <th>Statut</th>
                            <th>Date de notification</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const tableBody = document.querySelector('.notification-table tbody');
        // Show loading state
        tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Chargement des données...</td></tr>';

        fetch('http://127.0.0.1:8000/api/notifications', {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            mode: 'cors'
        })
        .then(response => {
            if (!response.ok) {
                return response.text().then(text => {
                    throw new Error(`HTTP error! status: ${response.status}, message: ${text}`);
                });
            }
            return response.json();
        })
        .then(data => {
            tableBody.innerHTML = '';
            if (!data.data || data.data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Aucune notification trouvée</td></tr>';
                return;
            }
            data.data.forEach(notification => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${notification.id || ''}</td>
                    <td>${notification.sender_id || ''}</td>
                    <td>${notification.receiver_id || ''}</td>
                    <td>${notification.service_id || ''}</td>
                    <td>${notification.type || ''}</td>
                    <td>${notification.message || ''}</td>
                    <td>${notification.status || ''}</td>
                    <td>${notification.created_at || ''}</td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(error => {
            console.error('Error details:', error);
            tableBody.innerHTML = `<tr><td colspan="8" style="text-align: center; color: red;">Erreur lors du chargement des données: ${error.message}</td></tr>`;
        });
    });
    </script>
</body>
</html>